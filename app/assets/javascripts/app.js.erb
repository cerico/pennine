scenic = angular.module('scenic',['controllers'])

controllers = angular.module('controllers',[])


scenic.controller("TrailsController", [ '$scope','$location','$http', function($scope,$location,$http) {


  $scope.favstate = "notfaved"
  $scope.compstate = "notcompleted"

  $scope.getTrailInfo = function (){
    $http.get($location.$$absUrl + '.json').success (function (data){
      $scope.trail = data
      $scope.checkUserBookmark()
      console.log($scope.trail)

    })
  }

  $scope.getTrailInfo()

  $scope.checkUserBookmark = function (){

    if  ($scope.trail.userbookmark) {
      if ($scope.trail.userbookmark.favourited == true) {
        $scope.favstate = "faved"
      }
      else {
        $scope.favstate = "notfaved"
      }
      if ($scope.trail.userbookmark.completed == true) {
        $scope.compstate = "completed"
      }
      else {
        $scope.compstate = "notcompleted"
      }
    }
    else{
      $scope.favstate = "notfaved"
      $scope.compstate = "notcompleted"
    }
  } 

    $scope.addFav = function (f){

      var letsBookmark = {}
      letsBookmark.trail_id = $scope.trail.id
      letsBookmark.user_id = $scope.trail.user.id

      if (f == 'favit') {
        modit = {favourited: true}
        letsBookmark.favourited = true
      }else if (f == 'unfavit') {
        modit = {favourited: false}

      }else if (f == 'doneit') {
        modit = {completed: true}
        letsBookmark.completed = true

      }else if (f = 'undoneit') {
        modit = {completed: false}

      }

      letsBookmark.favourited = true



      if ($scope.trail.userbookmark) {         
       $http.put('/bookmarks/' + $scope.trail.userbookmark.id + '.json', modit).success (function (data){
        $scope.getTrailInfo() 
       });
     }else{      
      $http.post('/bookmarks.json', {bookmark: letsBookmark}).success (function (data){
        $scope.getTrailInfo() 
      })
      
    } 
  }






}])